<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Posts | Rogger</title>
    <link rel="stylesheet" href="../../../css/main.css">
</head>
<body>
  <script>
    function rmp(pid) {
	const xhr = new XMLHttpRequest();
        const url = "/api/removePost";
        const params = "api_key="+
              new Map(document.cookie.split("; ").map(cookie => cookie.split('='))).get('session')
            +"&id="+pid;
	xhr.open("POST", url, true);
        xhr.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
        xhr.onreadystatechange = function() {
            if (this.readyState == XMLHttpRequest.DONE && this.status == 200) {
                console.log(xhr.responseText);
            }
        };
        xhr.send(params);
	xhr.addEventListener('load', function() {
	    if (xhr.status === 200) {
		window.location.reload();
	    }
	});
    }
  </script>
  <main>
    <p>You are logged as <b>Rogger_Admin</b> <a href="/api/endSession">Logout</a></p>
        <div class="posts-container">
	   <div class="post">
	   <h2 class="title"><a href="/cms/post_new"><b>Add new post</b></a></h2>
	</div>
         {% for post in posts %}
	<div class="post">
	  <h2 class="title"><a href="/cms/post_edit/{{ post.id }}"><b>{{ post.title }}</b></a></h2>
	  <p class="description">{{ post.content }}</p>
	  <span class="date">{{ post.date }}</span>
	  <p class="remove-link" onclick="rmp({{ post.id }})"><b>remove post</b></p>
	</div>
	{% endfor %}
        </div>
    </main>
    <footer>
        {% if curr_page == 1 %}
      <p><span style="color: rgb(242, 242, 242);">1</span> <a href="/posts/2">2</a></p>
      {% else %}
         <p>
         {% for (i, ctr) in counter.iter().enumerate() %}
            {% if i == 1 %}
               <span style="color: rgb(242, 242, 242);">{{ ctr }}</span>
            {% else %}
	       <a href="/posts/{{ ctr }}">{{ ctr }}</a>
	    {% endif %}
	 {% endfor %}
	 </p>     
     {% endif %}     
    </footer>
</body>
</html>
